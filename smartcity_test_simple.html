<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart City SVG Test - Simple</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { border: 2px solid #ddd; padding: 20px; margin: 10px 0; }
        .component { border: 1px solid #ccc; padding: 10px; margin: 5px 0; }
        .svg-preview { border: 1px solid #999; width: 300px; height: 200px; position: relative; }
        .highlight { position: absolute; border: 3px solid #00ff00; background: rgba(0, 255, 0, 0.2); }
    </style>
</head>
<body>
    <h1>Smart City SVG Test - Simple</h1>
    
    <div class="test-container">
        <h2>Test Individual Components</h2>
        <div id="test-results"></div>
    </div>

    <script>
        // Test with just 3 individual components
        const testComponents = [
            {"name": "1. SuperMap GIS", "x": 69.5625, "y": 6203.1914, "width": 529.6417, "height": 273.4863},
            {"name": "2. Google Maps", "x": 6125.3125, "y": 6203.1914, "width": 536.8896, "height": 273.4863},
            {"name": "3. Municipal Web Portal", "x": 17146.6875, "y": 160.2539, "width": 512.8601, "height": 474.4141}
        ];

        let fullSVG = null;

        async function loadSVG() {
            try {
                const response = await fetch('http://localhost:3004/assets/diagrams/SmartCity_C4_Diagram.svg');
                const svgText = await response.text();
                fullSVG = svgText;
                console.log('SVG loaded successfully');
                renderTest();
            } catch (error) {
                console.error('Error loading SVG:', error);
            }
        }

        function renderTest() {
            const container = document.getElementById('test-results');
            container.innerHTML = '';

            testComponents.forEach((component, index) => {
                console.log(`=== RENDERING COMPONENT ${index} ===`);
                console.log(`Component: ${component.name}`);
                console.log(`Coordinates: X=${component.x}, Y=${component.y}, W=${component.width}, H=${component.height}`);

                const div = document.createElement('div');
                div.className = 'component';
                div.innerHTML = `
                    <h3>${component.name}</h3>
                    <div class="svg-preview" id="preview_${index}">
                        <div class="highlight" id="highlight_${index}"></div>
                    </div>
                    <p>X: ${component.x}, Y: ${component.y}, W: ${component.width}, H: ${component.height}</p>
                `;
                container.appendChild(div);

                // Update the highlight
                updateHighlight(index, component);
            });
        }

        function updateHighlight(index, component) {
            if (!fullSVG) return;

            const highlight = document.getElementById(`highlight_${index}`);
            if (!highlight) return;

            // Calculate the viewBox to show the component area with some padding
            const padding = 200;
            const viewBoxX = Math.max(0, component.x - padding);
            const viewBoxY = Math.max(0, component.y - padding);
            const viewBoxWidth = component.width + (padding * 2);
            const viewBoxHeight = component.height + (padding * 2);

            // Calculate the scale factor based on the preview size
            const previewWidth = 300;
            const previewHeight = 200;
            const scaleX = previewWidth / viewBoxWidth;
            const scaleY = previewHeight / viewBoxHeight;

            // Calculate final positions
            const componentX = component.x - viewBoxX;
            const componentY = component.y - viewBoxY;
            const finalLeft = componentX * scaleX;
            const finalTop = componentY * scaleY;
            const finalWidth = component.width * scaleX;
            const finalHeight = component.height * scaleY;

            console.log(`=== HIGHLIGHT CALCULATION FOR ${index} ===`);
            console.log(`ViewBox: X=${viewBoxX}, Y=${viewBoxY}, W=${viewBoxWidth}, H=${viewBoxHeight}`);
            console.log(`Component in View: X=${componentX}, Y=${componentY}`);
            console.log(`Scales: X=${scaleX.toFixed(4)}, Y=${scaleY.toFixed(4)}`);
            console.log(`Final Border: Left=${finalLeft.toFixed(2)}px, Top=${finalTop.toFixed(2)}px, W=${finalWidth.toFixed(2)}px, H=${finalHeight.toFixed(2)}px`);
            console.log(`Border % of Preview: W=${((finalWidth/300)*100).toFixed(1)}%, H=${((finalHeight/200)*100).toFixed(1)}%`);
            console.log(`==========================================`);

            // Position and size the highlight
            highlight.style.left = finalLeft + 'px';
            highlight.style.top = finalTop + 'px';
            highlight.style.width = finalWidth + 'px';
            highlight.style.height = finalHeight + 'px';

            // Create cropped SVG
            const croppedSVG = fullSVG.replace(
                'viewBox="0 0 20293 12756"',
                `viewBox="${viewBoxX} ${viewBoxY} ${viewBoxWidth} ${viewBoxHeight}"`
            );

            // Insert the cropped SVG
            const preview = document.getElementById(`preview_${index}`);
            preview.innerHTML = croppedSVG;
            
            // Re-add the highlight on top
            preview.appendChild(highlight);
        }

        // Load SVG when page loads
        loadSVG();
    </script>
</body>
</html>
