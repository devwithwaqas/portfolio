<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart City C4 Diagram - Component Verification</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2em;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        
        .content {
            padding: 20px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
        
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .component-card {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .component-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .component-card.correct {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .component-card.wrong {
            border-color: #dc3545;
            background: #fff8f8;
        }
        
        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .component-id {
            font-weight: bold;
            color: #495057;
        }
        
        .component-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .type-rectangle { background: #e3f2fd; color: #1976d2; }
        .type-ellipse { background: #fff3e0; color: #f57c00; }
        .type-polygon { background: #f3e5f5; color: #7b1fa2; }
        .type-user { background: #e8f5e8; color: #388e3c; }
        .type-users_cluster { background: #e8f5e8; color: #2e7d32; }
        .type-group { background: #fce4ec; color: #c2185b; }
        
        .component-text {
            margin: 10px 0;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .component-coords {
            font-family: monospace;
            font-size: 0.8em;
            color: #6c757d;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 4px;
            margin: 5px 0;
        }
        
        .component-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-correct {
            background: #28a745;
            color: white;
        }
        
        .btn-correct:hover {
            background: #218838;
        }
        
        .btn-wrong {
            background: #dc3545;
            color: white;
        }
        
        .btn-wrong:hover {
            background: #c82333;
        }
        
        .btn-edit {
            background: #17a2b8;
            color: white;
        }
        
        .btn-edit:hover {
            background: #138496;
        }
        
        .svg-preview {
            width: 100%;
            height: 200px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin: 10px 0;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }
        
        .coordinate-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .coord-input {
            display: flex;
            flex-direction: column;
        }
        
        .coord-input label {
            font-size: 0.8em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 2px;
        }
        
        .coord-input input {
            padding: 4px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.8em;
        }
        
        .export-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn-export {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-export:hover {
            background: #5a6268;
        }
        
        .summary {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .summary h3 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .summary-stat {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        
        .summary-stat-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #495057;
        }
        
        .summary-stat-label {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        /* Component highlight styling (like BAT page) */
        .component-highlight {
            position: absolute;
            border: 3px solid #00ff00;
            background-color: rgba(0, 255, 0, 0.1);
            pointer-events: none;
            z-index: 10;
        }
        
        .svg-preview {
            position: relative;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèôÔ∏è Smart City C4 Diagram - Component Verification</h1>
            <div class="stats">
                <div class="stat">
                    <span class="stat-number" id="totalComponents">0</span>
                    <span>Total Components</span>
                </div>
                <div class="stat">
                    <span class="stat-number" id="correctCount">0</span>
                    <span>Correct</span>
                </div>
                <div class="stat">
                    <span class="stat-number" id="wrongCount">0</span>
                    <span>Wrong</span>
                </div>
                <div class="stat">
                    <span class="stat-number" id="remainingCount">0</span>
                    <span>Remaining</span>
                </div>
            </div>
        </div>
        
        <div class="content">
            <div class="summary">
                <h3>üìä Extraction Summary</h3>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="individualShapes">0</div>
                        <div class="summary-stat-label">Individual Shapes</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="groups">0</div>
                        <div class="summary-stat-label">Groups</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="users">0</div>
                        <div class="summary-stat-label">Users</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="databases">0</div>
                        <div class="summary-stat-label">Databases</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">üë• Users Cluster (1 expected - boundary around 4 users)</div>
                <div class="components-grid" id="usersGrid"></div>
            </div>
            
            <div class="section">
                <div class="section-title">üì¶ Groups (8 expected)</div>
                <div class="components-grid" id="groupsGrid"></div>
            </div>
            
            <div class="section">
                <div class="section-title">üî∑ Individual Shapes (42 expected - 38 regular + 4 database cylinders)</div>
                <div class="components-grid" id="individualGrid"></div>
            </div>
            
            <div class="section">
                <div class="section-title">üóÑÔ∏è Database Cylinders (included in Individual Shapes 39-42)</div>
                <div class="components-grid" id="databasesGrid"></div>
            </div>
            
            <div class="export-section">
                <h3>üì§ Export Results</h3>
                <p>Export verified components for use in narration configuration:</p>
                <div class="export-buttons">
                    <button class="btn-export" onclick="exportToJSON()">Export JSON</button>
                    <button class="btn-export" onclick="exportToCSV()">Export CSV</button>
                    <button class="btn-export" onclick="copyToClipboard()">Copy to Clipboard</button>
                </div>
                
                <h3 style="margin-top: 30px;">üîç Reference</h3>
                <p>View the full Smart City C4 diagram for reference:</p>
                <div class="export-buttons">
                    <button class="btn-export" onclick="window.open('public/assets/diagrams/SmartCity_C4_Diagram.svg', '_blank')">View Full SVG Diagram</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load components data
        let componentsData = null;
        
        // Load the extracted components
        fetch('smartcity_final_coordinates.json')
            .then(response => response.json())
            .then(data => {
                componentsData = data;
                console.log('Loaded components data:', componentsData);
                console.log('Individual shapes count:', componentsData.individual_shapes ? componentsData.individual_shapes.length : 0);
                console.log('First few shapes:', componentsData.individual_shapes ? componentsData.individual_shapes.slice(0, 3) : []);
                renderComponents();
                updateStats();
            })
            .catch(error => {
                console.error('Error loading components:', error);
                // Create empty structure if file doesn't exist
                componentsData = {
                    individual_shapes: [],
                    groups: [],
                    users: [],
                    viewbox: "0 0 20293 12756",
                    width: 20293,
                    height: 12756
                };
                renderComponents();
                updateStats();
            });
        
        function renderComponents() {
            renderUserComponents();
            renderGroupComponents();
            renderIndividualComponents();
            renderDatabaseComponents();
            
            // Auto-initialize SVG previews after a short delay
            setTimeout(() => {
                document.querySelectorAll('.component-card').forEach(card => {
                    updateSVGPreview(card.dataset.id);
                });
            }, 100);
        }
        
        function renderUserComponents() {
            const grid = document.getElementById('usersGrid');
            grid.innerHTML = '';
            
            // Use real data if available, otherwise create fallback
            if (componentsData.users && componentsData.users.length > 0) {
                componentsData.users.forEach(user => {
                    const card = createComponentCard(user, 'users');
                    grid.appendChild(card);
                });
            } else {
                // Fallback users cluster
                const usersCluster = {
                    id: 'users_cluster',
                    x: 100, y: 100, width: 800, height: 600,
                    text: 'Users Cluster (4 users)',
                    type: 'users_cluster',
                    area: 480000
                };
                
                const card = createComponentCard(usersCluster, 'users');
                grid.appendChild(card);
            }
        }
        
        function renderGroupComponents() {
            const grid = document.getElementById('groupsGrid');
            grid.innerHTML = '';
            
            // Use real data if available, otherwise create fallbacks
            if (componentsData.groups && componentsData.groups.length > 0) {
                componentsData.groups.forEach(group => {
                    const card = createComponentCard(group, 'groups');
                    grid.appendChild(card);
                });
            } else {
                // Add 8 expected groups with reasonable positions
                for (let i = 0; i < 8; i++) {
                    const group = {
                        id: `group_${i + 1}`,
                        x: 200 + (i * 200), y: 200 + (i * 150), width: 400, height: 300,
                        text: `Group ${i + 1}`,
                        type: 'group',
                        component_count: 0
                    };
                    
                    const card = createComponentCard(group, 'groups');
                    grid.appendChild(card);
                }
            }
        }
        
        function renderIndividualComponents() {
            const grid = document.getElementById('individualGrid');
            grid.innerHTML = '';
            
            // Use real data if available, otherwise create fallbacks
            if (componentsData.individual_shapes && componentsData.individual_shapes.length > 0) {
                // Show first 42 shapes from real data
                const shapesToShow = componentsData.individual_shapes.slice(0, 42);
                shapesToShow.forEach((shape, index) => {
                    const card = createComponentCard(shape, 'individual');
                    grid.appendChild(card);
                });
                
                // If we have less than 42, add placeholders for the rest
                for (let i = shapesToShow.length; i < 42; i++) {
                    const placeholder = {
                        id: `shape_${i + 1}`,
                        x: 100 + (i * 50), y: 100 + (i * 30), width: 200, height: 100,
                        text: `Shape ${i + 1} (placeholder)`,
                        type: i >= 38 ? 'polygon' : 'rectangle',
                        area: 20000
                    };
                    
                    const card = createComponentCard(placeholder, 'individual');
                    grid.appendChild(card);
                }
            } else {
                // Fallback: Add 42 expected individual shapes
                for (let i = 0; i < 42; i++) {
                    const shape = {
                        id: `shape_${i + 1}`,
                        x: 100 + (i * 50), y: 100 + (i * 30), width: 200, height: 100,
                        text: `Shape ${i + 1}`,
                        type: i >= 38 ? 'polygon' : 'rectangle',
                        area: 20000
                    };
                    
                    const card = createComponentCard(shape, 'individual');
                    grid.appendChild(card);
                }
            }
        }
        
        function renderDatabaseComponents() {
            const grid = document.getElementById('databasesGrid');
            grid.innerHTML = '';
            
            // Note: Database cylinders are included in individual shapes (shapes 39-42)
            grid.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Database cylinders are included in Individual Shapes (shapes 39-42)</p>';
        }
        
        function createComponentCard(component, category) {
            const card = document.createElement('div');
            card.className = 'component-card';
            card.dataset.id = component.id;
            card.dataset.category = category;
            card.dataset.correct = 'false';
            
            card.innerHTML = `
                <div class="component-header">
                    <span class="component-id">${component.id}</span>
                    <span class="component-type type-${component.type}">${component.type}</span>
                </div>
                
                <div class="component-text">
                    <input type="text" value="${component.text}" onchange="updateComponentText('${component.id}', this.value)" 
                           style="width: 100%; padding: 5px; border: 1px solid #ced4da; border-radius: 4px;">
                </div>
                
                <div class="coordinate-inputs">
                    <div class="coord-input">
                        <label>X</label>
                        <input type="number" value="${component.x}" onchange="updateComponentCoords('${component.id}', 'x', this.value)">
                    </div>
                    <div class="coord-input">
                        <label>Y</label>
                        <input type="number" value="${component.y}" onchange="updateComponentCoords('${component.id}', 'y', this.value)">
                    </div>
                    <div class="coord-input">
                        <label>Width</label>
                        <input type="number" value="${component.width}" onchange="updateComponentCoords('${component.id}', 'width', this.value)">
                    </div>
                    <div class="coord-input">
                        <label>Height</label>
                        <input type="number" value="${component.height}" onchange="updateComponentCoords('${component.id}', 'height', this.value)">
                    </div>
                </div>
                
                <div class="component-coords">
                    Area: ${component.area ? component.area.toFixed(0) : 'N/A'} | 
                    ${component.width.toFixed(1)} √ó ${component.height.toFixed(1)}
                </div>
                
                <div class="svg-preview" id="preview_${component.id}">
                    SVG Preview will load here
                </div>
                
                <div class="component-actions">
                    <button class="btn btn-correct" onclick="markCorrect('${component.id}')">‚úì Correct</button>
                    <button class="btn btn-wrong" onclick="markWrong('${component.id}')">‚úó Wrong</button>
                    <button class="btn btn-edit" onclick="updateSVGPreview('${component.id}')">üîÑ Update Preview</button>
                </div>
            `;
            
            return card;
        }
        
        function updateComponentText(id, text) {
            const card = document.querySelector(`[data-id="${id}"]`);
            if (card) {
                // Update the component data
                const category = card.dataset.category;
                // Find and update in the appropriate array
                updateComponentInData(id, 'text', text);
            }
        }
        
        function updateComponentCoords(id, coord, value) {
            const card = document.querySelector(`[data-id="${id}"]`);
            if (card) {
                updateComponentInData(id, coord, parseFloat(value));
                
                // Update the display
                const coordsDiv = card.querySelector('.component-coords');
                const width = card.querySelector('input[onchange*="width"]').value;
                const height = card.querySelector('input[onchange*="height"]').value;
                coordsDiv.innerHTML = `Area: ${(parseFloat(width) * parseFloat(height)).toFixed(0)} | ${width} √ó ${height}`;
            }
        }
        
        function updateComponentInData(id, property, value) {
            // This would update the actual component data
            // For now, we'll just update the display
        }
        
        function markCorrect(id) {
            const card = document.querySelector(`[data-id="${id}"]`);
            if (card) {
                card.classList.remove('wrong');
                card.classList.add('correct');
                card.dataset.correct = 'true';
                updateStats();
            }
        }
        
        function markWrong(id) {
            const card = document.querySelector(`[data-id="${id}"]`);
            if (card) {
                card.classList.remove('correct');
                card.classList.add('wrong');
                card.dataset.correct = 'false';
                updateStats();
            }
        }
        
        // Cache for full SVG content (like BAT page)
        let fullSVG = null;
        
        function loadFullSVG() {
            if (fullSVG) {
                return Promise.resolve(fullSVG);
            }
            
            return fetch('public/assets/diagrams/SmartCity_C4_Diagram.svg')
                .then(response => response.text())
                .then(content => {
                    fullSVG = content;
                    return content;
                })
                .catch(error => {
                    console.error('Error loading SVG:', error);
                    return null;
                });
        }
        
        function updateSVGPreview(id) {
            const card = document.querySelector(`[data-id="${id}"]`);
            const preview = card.querySelector('.svg-preview');
            
            const x = parseFloat(card.querySelector('input[onchange*="x"]').value) || 0;
            const y = parseFloat(card.querySelector('input[onchange*="y"]').value) || 0;
            const width = parseFloat(card.querySelector('input[onchange*="width"]').value) || 100;
            const height = parseFloat(card.querySelector('input[onchange*="height"]').value) || 100;
            
            // Validate coordinates
            if (isNaN(x) || isNaN(y) || isNaN(width) || isNaN(height) || width <= 0 || height <= 0) {
                preview.innerHTML = '<div style="color: #dc3545; text-align: center; padding: 20px;">Invalid coordinates</div>';
                return;
            }
            
            // Show loading with debug info
            preview.innerHTML = `<div style="text-align: center; padding: 20px; color: #6c757d;">
                Loading SVG preview...<br>
                <small>Debug: x=${x}, y=${y}, w=${width}, h=${height}</small>
            </div>`;
            
            // Load full SVG and create cropped preview
            loadFullSVG().then(svgContent => {
                if (!svgContent) {
                    preview.innerHTML = '<div style="color: #dc3545; text-align: center; padding: 20px;">Error loading SVG</div>';
                    return;
                }
                
                // Calculate viewBox for cropping with proper padding
                const padding = Math.max(100, Math.min(width, height) * 0.5); // Dynamic padding
                const viewBoxX = Math.max(0, x - padding);
                const viewBoxY = Math.max(0, y - padding);
                const viewBoxWidth = Math.min(componentsData.width - viewBoxX, width + (padding * 2));
                const viewBoxHeight = Math.min(componentsData.height - viewBoxY, height + (padding * 2));
                
                console.log(`Cropping SVG for ${id}:`, {
                    component: { x, y, width, height },
                    viewBox: { x: viewBoxX, y: viewBoxY, width: viewBoxWidth, height: viewBoxHeight },
                    padding,
                    svgBounds: { width: componentsData.width, height: componentsData.height }
                });
                
                // Check if viewBox is reasonable
                if (viewBoxWidth > componentsData.width || viewBoxHeight > componentsData.height) {
                    console.error(`ViewBox too large for ${id}:`, { viewBoxWidth, viewBoxHeight, svgWidth: componentsData.width, svgHeight: componentsData.height });
                }
                
                // Create cropped SVG
                const croppedSVG = svgContent.replace(
                    'viewBox="0 0 20293 12756"',
                    `viewBox="${viewBoxX} ${viewBoxY} ${viewBoxWidth} ${viewBoxHeight}"`
                );
                
                // Parse the cropped SVG to add proper styling
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(croppedSVG, 'image/svg+xml');
                const svgElement = svgDoc.querySelector('svg');
                
                console.log('SVG parsing result:', {
                    hasSVG: !!svgElement,
                    parseError: svgDoc.querySelector('parsererror'),
                    croppedSVGLength: croppedSVG.length
                });
                
                if (svgElement) {
                    // Set proper dimensions and maintain aspect ratio
                    svgElement.setAttribute('width', '100%');
                    svgElement.setAttribute('height', '200px');
                    svgElement.setAttribute('preserveAspectRatio', 'xMidYMid meet');
                    svgElement.style.border = '1px solid #dee2e6';
                    svgElement.style.borderRadius = '4px';
                    svgElement.style.display = 'block';
                    svgElement.style.margin = '0 auto';
                    
                    // Add highlight rectangle directly to SVG
                    const highlightRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    highlightRect.setAttribute('x', x - viewBoxX);
                    highlightRect.setAttribute('y', y - viewBoxY);
                    highlightRect.setAttribute('width', width);
                    highlightRect.setAttribute('height', height);
                    highlightRect.setAttribute('fill', 'rgba(0, 255, 0, 0.2)');
                    highlightRect.setAttribute('stroke', '#00ff00');
                    highlightRect.setAttribute('stroke-width', '3');
                    highlightRect.setAttribute('stroke-dasharray', '5,5');
                    
                    // Add component label
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('x', (x - viewBoxX) + width/2);
                    label.setAttribute('y', (y - viewBoxY) + height/2);
                    label.setAttribute('text-anchor', 'middle');
                    label.setAttribute('fill', '#00ff00');
                    label.setAttribute('font-size', '12');
                    label.setAttribute('font-weight', 'bold');
                    label.setAttribute('font-family', 'Arial, sans-serif');
                    label.textContent = card.querySelector('input[type="text"]').value;
                    
                    svgElement.appendChild(highlightRect);
                    svgElement.appendChild(label);
                    
                    // Convert back to string
                    const serializer = new XMLSerializer();
                    const finalSVG = serializer.serializeToString(svgElement);
                    
                    preview.innerHTML = finalSVG;
                } else {
                    // Fallback: show the raw cropped SVG
                    console.log('SVG parsing failed, showing raw SVG');
                    preview.innerHTML = `
                        <div style="color: #dc3545; text-align: center; padding: 10px;">SVG Parse Error - Showing Raw:</div>
                        <div style="max-height: 150px; overflow: auto; border: 1px solid #dee2e6; padding: 10px; background: #f8f9fa;">
                            <pre style="font-size: 10px; margin: 0;">${croppedSVG.substring(0, 1000)}...</pre>
                        </div>
                    `;
                }
            });
        }
        
        function updateStats() {
            const totalCards = document.querySelectorAll('.component-card').length;
            const correctCards = document.querySelectorAll('.component-card.correct').length;
            const wrongCards = document.querySelectorAll('.component-card.wrong').length;
            const remainingCards = totalCards - correctCards - wrongCards;
            
            document.getElementById('totalComponents').textContent = totalCards;
            document.getElementById('correctCount').textContent = correctCards;
            document.getElementById('wrongCount').textContent = wrongCards;
            document.getElementById('remainingCount').textContent = remainingCards;
            
            // Update category stats
            document.getElementById('individualShapes').textContent = document.querySelectorAll('#individualGrid .component-card').length;
            document.getElementById('groups').textContent = document.querySelectorAll('#groupsGrid .component-card').length;
            document.getElementById('users').textContent = document.querySelectorAll('#usersGrid .component-card').length;
            document.getElementById('databases').textContent = '4 (included in Individual Shapes 39-42)';
        }
        
        function exportToJSON() {
            const components = [];
            document.querySelectorAll('.component-card').forEach(card => {
                if (card.dataset.correct === 'true') {
                    const x = parseFloat(card.querySelector('input[onchange*="x"]').value);
                    const y = parseFloat(card.querySelector('input[onchange*="y"]').value);
                    const width = parseFloat(card.querySelector('input[onchange*="width"]').value);
                    const height = parseFloat(card.querySelector('input[onchange*="height"]').value);
                    const text = card.querySelector('input[type="text"]').value;
                    
                    components.push({
                        id: card.dataset.id,
                        category: card.dataset.category,
                        text: text,
                        x: x,
                        y: y,
                        width: width,
                        height: height,
                        type: card.querySelector('.component-type').textContent
                    });
                }
            });
            
            const dataStr = JSON.stringify(components, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'smartcity_verified_components.json';
            link.click();
        }
        
        function exportToCSV() {
            const components = [];
            document.querySelectorAll('.component-card').forEach(card => {
                if (card.dataset.correct === 'true') {
                    const x = parseFloat(card.querySelector('input[onchange*="x"]').value);
                    const y = parseFloat(card.querySelector('input[onchange*="y"]').value);
                    const width = parseFloat(card.querySelector('input[onchange*="width"]').value);
                    const height = parseFloat(card.querySelector('input[onchange*="height"]').value);
                    const text = card.querySelector('input[type="text"]').value;
                    
                    components.push([
                        card.dataset.id,
                        card.dataset.category,
                        text,
                        x,
                        y,
                        width,
                        height,
                        card.querySelector('.component-type').textContent
                    ]);
                }
            });
            
            const csvContent = [
                ['ID', 'Category', 'Text', 'X', 'Y', 'Width', 'Height', 'Type'],
                ...components
            ].map(row => row.join(',')).join('\n');
            
            const dataBlob = new Blob([csvContent], {type: 'text/csv'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'smartcity_verified_components.csv';
            link.click();
        }
        
        function copyToClipboard() {
            const components = [];
            document.querySelectorAll('.component-card').forEach(card => {
                if (card.dataset.correct === 'true') {
                    const x = parseFloat(card.querySelector('input[onchange*="x"]').value);
                    const y = parseFloat(card.querySelector('input[onchange*="y"]').value);
                    const width = parseFloat(card.querySelector('input[onchange*="width"]').value);
                    const height = parseFloat(card.querySelector('input[onchange*="height"]').value);
                    const text = card.querySelector('input[type="text"]').value;
                    
                    components.push({
                        id: card.dataset.id,
                        category: card.dataset.category,
                        text: text,
                        x: x,
                        y: y,
                        width: width,
                        height: height,
                        type: card.querySelector('.component-type').textContent
                    });
                }
            });
            
            const dataStr = JSON.stringify(components, null, 2);
            navigator.clipboard.writeText(dataStr).then(() => {
                alert('Components copied to clipboard!');
            });
        }
    </script>
</body>
</html>
